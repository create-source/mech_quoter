<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Repair Estimator</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

  <link rel="stylesheet" href="/static/style.css">
  <script src="/static/app.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">Repair Estimator</div>
    <div class="tabs">
      <button class="tab active" id="tabCustomer">Customer</button>
      <button class="tab" id="tabOwner">Shop Owner</button>
    </div>
  </header>

  <main class="container">

    <!-- CUSTOMER -->
    <section id="customerPanel">
      <h2>Customer Estimate</h2>

      <div class="card">
        <h3>Customer</h3>
        <div class="grid">
          <label>Name <input id="customerName" type="text" placeholder="John Doe"></label>
          <label>Phone <input id="customerPhone" type="tel" placeholder="(555) 555-5555"></label>
          <label>Email <input id="customerEmail" type="email" placeholder="you@email.com"></label>
          <label>ZIP <input id="zipCode" type="text" inputmode="numeric" placeholder="92646"></label>
        </div>
      </div>

      <div class="card">
        <h3>Vehicle</h3>
        <div class="grid">
          <label>Year
            <select id="yearSelect"></select>
          </label>

          <label>Make (popular)
            <select id="makeSelect"></select>
          </label>

          <label>Model
            <select id="modelSelect"></select>
          </label>
        </div>
      </div>

      <div class="card">
        <h3>Service</h3>
        <div class="grid">
          <label>Category
            <select id="categorySelect"></select>
          </label>

          <label>Service
            <select id="serviceSelect"></select>
          </label>
        </div>

        <div class="grid">
          <label>Labor Hours
            <input id="laborHours" type="number" step="0.1" min="0" placeholder="e.g. 1.5">
          </label>

          <label>Parts Price
            <input id="partsPrice" type="number" step="0.01" min="0" placeholder="e.g. 125.00">
          </label>

          <label>Tax Rate (optional)
            <input id="taxRate" type="number" step="0.01" min="0" max="0.2" placeholder="0.00">
          </label>
        </div>

        <label class="block">Notes
          <textarea id="notes" rows="3" placeholder="Optional notes..."></textarea>
        </label>

        <div class="actions">
          <button class="btn primary" id="btnCreateEstimate">Create Estimate</button>
        </div>

        <div id="estimateResult" class="result"></div>
      </div>

      <div class="card" id="approvalCard" style="display:none;">
        <h3>Customer Signature = Approval</h3>
        <p class="muted">Have the customer sign to approve the estimate.</p>

        <div class="sigWrap">
          <canvas id="sigCanvas" width="700" height="200"></canvas>
        </div>

        <div class="actions">
          <button class="btn" id="btnClearSig">Clear</button>
          <button class="btn primary" id="btnApprove">Approve + Generate PDF</button>
          <a class="btn" id="btnDownloadEstimatePdf" href="#" target="_blank" rel="noopener">Download Estimate PDF</a>
        </div>

        <div id="approvalResult" class="result"></div>
      </div>

      <div class="card" id="paymentCard" style="display:none;">
        <h3>Invoice Signature = Payment Acknowledgement</h3>
        <p class="muted">Customer signs to acknowledge payment on the invoice.</p>

        <div class="sigWrap">
          <canvas id="payCanvas" width="700" height="200"></canvas>
        </div>

        <div class="actions">
          <button class="btn" id="btnClearPaySig">Clear</button>
          <button class="btn primary" id="btnAckPayment">Acknowledge Payment + PDF</button>
          <a class="btn" id="btnDownloadInvoicePdf" href="#" target="_blank" rel="noopener">Download Invoice PDF</a>
        </div>

        <div id="paymentResult" class="result"></div>
      </div>
    </section>

    <!-- OWNER -->
    <section id="ownerPanel" style="display:none;">
      <h2>Shop Owner Backend</h2>

      <div class="card">
        <h3>Login</h3>
        <div class="grid">
          <label>Admin User <input id="adminUser" type="text" placeholder="admin"></label>
          <label>Admin Pass <input id="adminPass" type="password" placeholder="change_me"></label>
        </div>
        <div class="actions">
          <button class="btn primary" id="btnLoadAdmin">Load Estimates</button>
        </div>
        <div class="hint">
          Set Render env vars: <code>ADMIN_USER</code> and <code>ADMIN_PASS</code>.
        </div>
      </div>

      <div class="card">
        <h3>Estimates</h3>
        <div id="adminList" class="adminList"></div>
      </div>
    </section>

  </main>

  <script defer src="/static/app.js"></script>
</body>
</html>
