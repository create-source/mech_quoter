<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Repair estimator with PDF export." />
  <title>Repair Estimator</title>

  <!-- Styles -->
  <link rel="stylesheet" href="/static/style.css?v=1" />

  <!-- PWA -->
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#0b1220" />

  <!-- iOS home-screen support -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Estimator" />
  <link rel="apple-touch-icon" href="/static/icon-192.png" />

  <!-- Optional: helps avoid weird caching in some mobile webviews -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
</head>

<body>
  <noscript>
    <div class="container">
      <div class="card">
        <h2>JavaScript Required</h2>
        <p>This app requires JavaScript to run. Please enable JavaScript and reload.</p>
      </div>
    </div>
  </noscript>

  <div class="container">
    <header style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <h1 style="margin:0;">Repair Estimator</h1>

      <!-- Optional install button (only shows when supported) -->
      <button id="installBtn" type="button" style="display:none; margin-top:0;">
        Install App
      </button>
    </header>

    <!-- Vehicle -->
    <section class="card" aria-label="Vehicle">
      <div class="vehicle-header">
        <h2>Vehicle</h2>
        <button id="clearBtn" type="button">Clear fields</button>
      </div>

      <div class="grid3">
        <div>
          <label for="year">Year</label>
          <select id="year" name="year" autocomplete="off"></select>
        </div>

        <div>
          <label for="make">Make (popular)</label>
          <select id="make" name="make" autocomplete="off"></select>
        </div>

        <div>
          <label for="model">Model</label>
          <select id="model" name="model" autocomplete="off"></select>
        </div>
      </div>
    </section>

    <!-- Service -->
    <section class="card" aria-label="Service">
      <h2>Service</h2>

      <div class="grid2">
        <div>
          <label for="category">Category</label>
          <select id="category" name="category" autocomplete="off"></select>
        </div>

        <div>
          <label for="service">Service</label>
          <select id="service" name="service" autocomplete="off"></select>
        </div>
      </div>

      <div class="grid3">
        <div>
          <label for="laborHours">Labor Hours</label>
          <input id="laborHours" name="laborHours" type="number" step="0.1" value="0" inputmode="decimal" />
        </div>

        <div>
          <label for="partsPrice">Parts Price (optional)</label>
          <input id="partsPrice" name="partsPrice" type="number" step="0.01" value="0" inputmode="decimal" />
        </div>

        <div>
          <label for="laborRate">Labor Rate ($/hr)</label>
          <input id="laborRate" name="laborRate" type="number" step="1" value="90" inputmode="numeric" />
        </div>
      </div>

      <div style="margin-top: 10px;">
        <label for="notes">Notes (optional)</label>
        <textarea id="notes" name="notes" rows="3" placeholder="Optional notes..."></textarea>
      </div>

      <div class="actions" style="margin-top: 12px;">
        <button id="estimateBtn" type="button">Create Estimate</button>
        <button id="pdfBtn" type="button">Download PDF</button>
      </div>

      <div id="statusBox" class="status" role="status" aria-live="polite"></div>
    </section>

    <!-- Signature -->
    <section class="card" aria-label="Customer Signature">
      <div class="signature-header">
        <h2>Customer Signature</h2>
        <button id="sigClearBtn" type="button">Clear signature</button>
      </div>

      <canvas id="sigCanvas" class="sig-canvas"></canvas>
      <div class="sig-hint">
        Sign with finger or mouse. Signature will be included in PDF.
      </div>

      <div class="grid2">
        <div>
          <label for="customerName">Customer Name</label>
          <input id="customerName" name="customerName" type="text" placeholder="Customer name" autocomplete="name" />
        </div>

        <div>
          <label for="customerPhone">Customer Phone (optional)</label>
          <input id="customerPhone" name="customerPhone" type="tel" placeholder="(555) 555-5555" autocomplete="tel" />
        </div>
      </div>
    </section>
  </div>

  <!-- App JS (this file registers the service worker already) -->
  <script defer src="/static/app.js?v=1"></script>

  <!-- Optional install prompt helper (safe no-op on iOS) -->
  <script>
    let deferredPrompt = null;
    const installBtn = document.getElementById("installBtn");

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      if (installBtn) installBtn.style.display = "inline-block";
    });

    if (installBtn) {
      installBtn.addEventListener("click", async () => {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        await deferredPrompt.userChoice.catch(() => {});
        deferredPrompt = null;
        installBtn.style.display = "none";
      });
    }
  </script>
  <!-- Confirm Modal -->
<div id="confirmModal" class="modal hidden" aria-hidden="true">
  <div class="modal-backdrop" id="confirmBackdrop"></div>

  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <button class="modal-close" id="confirmXBtn" aria-label="Close">×</button>

    <h2 id="confirmTitle">Confirm</h2>
    <p class="muted">Does the customer agree with the estimate?</p>

    <label class="check">
      <input type="checkbox" id="customerAgreesChk" checked>
      Customer agrees
    </label>

    <div class="row">
      <p class="muted" style="margin:0 0 6px;">Do you want the customer’s signature?</p>
      <div class="radio-row">
        <label class="radio">
          <input type="radio" name="wantSig" value="yes" checked>
          Yes
        </label>
        <label class="radio">
          <input type="radio" name="wantSig" value="no">
          No
        </label>
      </div>
    </div>

    <div class="modal-actions">
      <button id="confirmAddBtn" type="button" class="btn primary">Add</button>
      <button id="confirmCloseBtn" type="button" class="btn secondary">Close</button>
    </div>

    <div id="confirmMsg" class="msg"></div>
  </div>
</div>

<!-- Signature Modal -->
<div id="sigModal" class="modal hidden" aria-hidden="true">
  <div class="modal-backdrop" id="sigBackdrop"></div>

  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="sigTitle">
    <button class="modal-close" id="sigXBtn" aria-label="Close">×</button>

    <h2 id="sigTitle">Customer Signature</h2>
    <p class="muted">Please sign below, then tap OK.</p>

    <div class="sig-wrap">
      <canvas id="sigCanvas" width="600" height="220"></canvas>
    </div>

    <div class="modal-actions">
      <button id="sigClearBtn" type="button" class="btn secondary">Clear</button>
      <button id="sigOkBtn" type="button" class="btn primary">OK</button>
    </div>

    <div id="sigMsg" class="msg"></div>
  </div>
</div>

</body>
</html>
